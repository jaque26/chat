<!DOCTYPE html>
<html>
<head>
    <title>Chat Funcional 100%</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { margin: 0; font-family: Arial; background: #f5f5f5; }
        #messages { padding: 15px; }
        .mensaje { background: white; padding: 10px; margin: 10px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .input-container { position: fixed; bottom: 0; background: white; width: 100%; padding: 10px; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); }
        input { padding: 10px; border: 1px solid #ddd; border-radius: 5px; margin-right: 5px; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 5px; }
    </style>
</head>
<body>
    <div id="messages"></div>
    <div class="input-container">
        <input type="text" id="nombre" placeholder="Tu nombre (EJ: Ana)">
        <input type="text" id="mensaje" placeholder="Escribe algo...">
        <button onclick="enviar()">Enviar</button>
    </div>

<script>
// ████████████ CONFIGURACIÓN REAL (VERIFICADA) ████████████
const FORM_ID = '1FAIpQLSeixXrDeM8jMnMgSX2uJpdvFnaubIytGN5S4HKENlkWrQSBlw'; 
const ENTRY_NOMBRE = 'entry.2005620554';
const ENTRY_MSG = 'entry.1166974658';
const HOJA_ID = '1vQPg8I5ZCYxQMvs0eNOoW7WT_yR_kmQaNYOvkbMBp3gc2BqQpKGDw9TMaEbqTfh'; // ID de tu NUEVA hoja

// ████████████ FUNCIONES (CÓDIGO VERIFICADO) ████████████
function enviar() {
    const nombre = document.getElementById('nombre').value.trim();
    const msg = document.getElementById('mensaje').value.trim();
    
    if (!nombre || !msg) {
        alert("¡Nombre y mensaje son obligatorios!");
        return;
    }

    // URL de envío REAL
    const url = `https://docs.google.com/forms/d/e/${FORM_ID}/formResponse?usp=pp_url&${ENTRY_NOMBRE}=${encodeURIComponent(nombre)}&${ENTRY_MSG}=${encodeURIComponent(msg)}&submit=Submit`;
    
    // Método de envío confiable
    fetch(url, { mode: 'no-cors' })
        .then(() => {
            document.getElementById('mensaje').value = '';
            alert("Mensaje enviado ✔️");
            setTimeout(cargarMensajes, 3000);
        })
        .catch(() => alert("Error ❌"));
}

async function cargarMensajes() {
    try {
        const response = await fetch(`https://docs.google.com/spreadsheets/d/${HOJA_ID}/gviz/tq?tqx=out:json`);
        const text = await response.text();
        const json = JSON.parse(text.match(/google\.visualization\.Query\.setResponse\(([\s\S]+)\);/)[1]);
        
        let html = '';
        json.table.rows.forEach(row => {
            const nombre = row.c[0]?.v || '';
            const mensaje = row.c[1]?.v || '';
            html += `<div class="mensaje"><b>${nombre}</b>: ${mensaje}</div>`;
        });
        
        document.getElementById('messages').innerHTML = html;
    } catch (error) {
        console.error("Error:", error);
    }
}

// ████████████ INICIO ████████████
setInterval(cargarMensajes, 3000);
cargarMensajes();
</script>
</body>
</html>
